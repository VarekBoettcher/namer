{
  "kind": "Template",
  "apiVersion": "v1",
  "metadata": {
    "name": "namer-dev",
    "annotations": {
      "openshift.io/display-name": "Namer-dev",
      "description": "CNR Namer",
      "tags": "python,flask",
      "iconClass": "icon-python"
    }
  },
  "labels": {
    "template": "namer-environment"
  },
  "objects": [
    {
      "kind": "Service",
      "apiVersion": "v1",
      "metadata": {
        "name": "${NAME}",
        "annotations": {
          "description": "Exposes and load balances the application pods"
        }
      },
      "spec": {
        "ports": [
          {
            "name": "web",
            "port": 5000,
            "targetPort": 5000
          }
        ],
        "selector": {
          "name": "${NAME}"
        }
      }
    },
    {
      "kind": "Route",
      "apiVersion": "v1",
      "metadata": {
        "name": "${NAME}"
      },
      "spec": {
        "host": "${APPLICATION_DOMAIN}",
        "to": {
          "kind": "Service",
          "name": "${NAME}"
        }
      }
    },
    {
      "apiVersion": "v1",
      "kind": "DeploymentConfig",
      "metadata": {
          "name": "${NAME}",
          "labels": {
              "template": "namer-environment"
          },
          "annotations": {
              "description": "Defines how to deploy the application server"
          }
      },
      "spec": {
          "strategy": {
              "type": "Rolling"
          },
          "triggers": [{
                  "type": "ImageChange",
                  "imageChangeParams": {
                      "automatic": true,
                      "containerNames": [
                          "namer"
                      ],
                      "from": {
                          "kind": "ImageStreamTag",
                          "namespace": "${APP_IMAGE_NAMESPACE}",
                          "name": "${NAME}:${APP_DEPLOYMENT_TAG}"
                      }
                  }
              },
              {
                  "type": "ConfigChange"
              }
          ],
          "replicas": 1,
          "selector": {
              "name": "${NAME}"
          },
          "template": {
              "metadata": {
                  "name": "${NAME}",
                  "creationTimestamp": null,
                  "labels": {
                      "name": "${NAME}"
                  }
              },
              "spec": {
                  "volumes": [{
                      "name": "namer-pv0",
                      "persistentVolumeClaim": {
                          "claimName": "namer-pv0"
                      }
                  }],
                  "containers": [{
                      "name": "${NAME}",
                      "image": " ",
                      "ports": [{
                          "containerPort": 5000,
                          "protocol": "TCP"
                      }],
                      "resources": {
                          "limits": {
                              "memory": "${MEMORY_LIMIT}"
                          }
                      },
                      "volumeMounts": [{
                          "name": "namer-pv0",
                          "mountPath": "/usr/src/app/files"
                      }],
                      "livenessProbe": {
                          "httpGet": {
                              "path": "/",
                              "port": 5000,
                              "scheme": "HTTP"
                          },
                          "initialDelaySeconds": 70,
                          "timeoutSeconds": 30,
                          "periodSeconds": 10,
                          "successThreshold": 1,
                          "failureThreshold": 3
                      },
                      "readinessProbe": {
                          "httpGet": {
                              "path": "/",
                              "port": 5000,
                              "scheme": "HTTP"
                          },
                          "initialDelaySeconds": 60,
                          "timeoutSeconds": 30,
                          "periodSeconds": 10,
                          "successThreshold": 1,
                          "failureThreshold": 3
                      },
                      "imagePullPolicy": "Always"
                  }],
                  "restartPolicy": "Always",
                  "terminationGracePeriodSeconds": 30,
                  "dnsPolicy": "ClusterFirst",
                  "securityContext": null
              }
          }
      }
  }
  ],
  "parameters": [
    {
      "name": "NAME",
      "displayName": "Name",
      "description": "The name assigned to all of the frontend objects defined in this template.",
      "required": true,
      "value": "namer-dev"
    },
    {
      "name": "PORT",
      "displayName": "Port",
      "description": "The port assigned to all of the frontend objects defined in this template.",
      "required": true,
      "value": "5000"
    },
    {
      "name": "APP_IMAGE_NAMESPACE",
      "displayName": "App Image Namespace",
      "required": true,
      "description": "The OpenShift Namespace where the ImageStream resides.",
      "value": "cddi-dlt-tools"
    },
    {
      "name": "MEMORY_LIMIT",
      "displayName": "Memory Limit",
      "required": true,
      "description": "Maximum amount of memory the Flask container can use.",
      "value": "4098Mi"
    },
    {
      "name": "APPLICATION_DOMAIN",
      "displayName": "Application Hostname",
      "description": "The exposed hostname that will route to the Flask service, if left blank a value will be defaulted.",
      "value": ""
    },
    {
      "name": "APP_DEPLOYMENT_TAG",
      "displayName": "Image tag to watch for changes and trigger deployment.",
      "description": "Image tag to watch for changes and trigger deployment.",
      "value": "test",
      "required": true
    }
  ]
}
